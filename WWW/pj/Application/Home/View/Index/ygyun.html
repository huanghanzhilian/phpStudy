<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>员工位置</title>
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css"/>
    <style type="text/css">
        .title {
            font: 13px 'Microsoft Yahei';
            color: #09f
        }
        .amap-info-content {
            font-size: 12px
        }
		
		.anbhudh{ background:red; position: absolute; top:100px; left:100px; z-index:100;}
		.opioc{ width:40px; height:70px; background:url(../../../../Public/img/manqq.png) center center no-repeat; background-size: 100%; position:relative;}
		.opioc span{ position:absolute; width:38px; height:15px; bottom:0px; left:0px; background:#fff; font-size:12px; border:1px solid #ccc; line-height:15px; text-align:center; color:#2d5ab8;}
		#start{ position:absolute; left:0px; z-index:200;}
    </style>
    
    <script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=94ca4100199c2f2a8f33300cece2eba2"></script>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
	<script src="__PUBLIC__/js/jquery-1.7.1.min.js"></script>
    <script src = "https://cdn.wilddog.com/js/client/current/wilddog.js" ></script>
</head>
<body>


<!--<button class="anbhudh" id="anbhudh">提交</button>-->
<div id="container"></div>

<script type="text/javascript">
//初始化地图对象，加载地图
var map = new AMap.Map("container", {
	resizeEnable: true,
	center: [116.397428, 39.90923],//地图中心点
	zoom: 12 //地图显示的缩放级别
}); 

map.plugin(["AMap.MapType"],function(){
    //地图类型切换
    var type= new AMap.MapType({
    defaultType:0 //使用2D地图
    });
    map.addControl(type);
});


function count(o){
    var t = typeof o;
    if(t == 'string'){
            return o.length;
    }else if(t == 'object'){
            var n = 0;
            for(var i in o){
                    n++;
            }
            return n;
    }
    return false;
}; 


var ref = new Wilddog("https://hjpyun123.wilddogio.com/users"); 

var marker;
var deliverysInQuery={}
//var nvar;

ref.on("child_added", function(data) { 
	butgh= data.val();
	deliverysInQuery[butgh.id]=butgh;
	butgh.nvar=dongqikai(butgh);
	
    //console.log(cch.val().username);   // 结果会在 console 中打印出 "beijing"
}, function(error){
    // 处理请求失败打错误
});

ref.on("child_changed", function(dataq) {
	
    var changedPost = dataq.val();
	var bnjlo=changedPost.location.split(",");
	//bnjlo.push(changedPost.location)
	var butghs=deliverysInQuery[changedPost.id].nvar;//改变的索引
	//hsah
	butghs.moveTo(bnjlo, 10000);
	//console.log(bnjlo)
	//console.log(butghs)
	
}, function(error){
    // 处理请求失败打错误
});


function dongqikai(data){
		marker=new AMap.Marker({
			map: map,
			position :butgh.location.split(","),
			topWhenClick: true,
			content:'<div class=opioc><span>'+(butgh.username)+'</span></div>'       
		});
		//marker.moveTo(cch[i], 1000);
	
	return marker;
}



   
/*addCloudLayer();  //叠加云数据图层
function addCloudLayer() {
	//加载云图层插件
	map.plugin('AMap.CloudDataLayer', function() {
		var layerOptions = {
			query: {keywords: ''},
			clickable: true
		};
		var cloudDataLayer = new AMap.CloudDataLayer('57fc7ffd305a2a4da23a5ce8', layerOptions); //实例化云图层类
		cloudDataLayer.setMap(map); //叠加云图层到地图
		AMap.event.addListener(cloudDataLayer, 'click', function(result) {
			var clouddata = result.data;
			var photo = [];
			if (clouddata._image[0]) {//如果有上传的图片
				photo = ['<img width=240 height=100 src="' + clouddata._image[0]._preurl + '"><br>'];
			}
			var infoWindow = new AMap.InfoWindow({
				content: "<font class='title'>" + clouddata._name + "</font><hr/>" + photo.join("") + "地址：" + clouddata._address + "<br />" + "创建时间：" + clouddata._createtime + "<br />" + "更新时间：" + clouddata._updatetime,
				size: new AMap.Size(0, 0),
				autoMove: true,
				offset: new AMap.Pixel(0, -25)
			});
			infoWindow.open(map, clouddata._location);
		});
	});
}  

document.getElementById('anbhudh').onclick=tijiao
function tijiao(){
	
	var key='b95d3d894e9faf82e00ff3f968525aed';
	var tableid='57fc7ffd305a2a4da23a5ce8';
	var ids='1,2';
	var data='{"_id":"8","_location":"117.538559,39.094801"}'
	$.ajax({
		
		url:"http://yuntuapi.amap.com/datamanage/data/update",
		data: {'key':key,'tableid':tableid,'data':data},
		contentType:"application/x-www-form-urlencoded",
		type: "post",
		dataType: "jsonp",
		//crossDomain: true,
		//processData: false, 
		//jsonp:'callback',  
		success: function (data) {
			console.log(data)
		}
	});
	
} */ 
</script>
</body>
</html>		





















				

	